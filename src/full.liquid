{% comment %} Full screen layout (800x480) {% endcomment %}

<div class="layout layout--col gap--space-4">
  {% case panel_type %}
    {% when 'stat' %}
      <div class="flex flex--col flex--center flex--middle h--full">
        <div class="value value--xxxl">{{ formatted_value | default: value }}</div>
        {% if description and description != '' %}
        <div class="description">{{ description }}</div>
        {% endif %}
      </div>

    {% when 'timeseries', 'barchart', 'graph' %}
      {% assign chart_id = 'chart-full' | append_random %}
      <div class="flex flex--col gap--space-2 h--full">
        <div id="{{ chart_id }}" class="w--full flex--grow"></div>
      </div>
      <script src="https://usetrmnl.com/js/highcharts/12.3.0/highcharts.js"></script>
      <script>
        Highcharts.chart('{{ chart_id }}', {
            chart: { type: 'line', backgroundColor: 'transparent' },
            title: { text: null },
            credits: { enabled: false },
            legend: { enabled: false },
            plotOptions: {
              series: {
                animation: false,
                color: '#000000',
                lineWidth: 2,
                marker: { enabled: false }
              }
            },
            xAxis: {
              categories: [{% for point in chart_data %}'{{ point.label }}'{% unless forloop.last %},{% endunless %}{% endfor %}],
              lineColor: '#000000'
            },
            yAxis: {
              title: { text: null },
              gridLineColor: '#cccccc'
            },
            series: [{
              data: [{% for point in chart_data %}{{ point.value }}{% unless forloop.last %},{% endunless %}{% endfor %}]
            }]
            });
      </script>

    {% when 'gauge' %}
      {% assign pct = percentage | default: 0 %}
      {% assign arc_length = 377 %}
      {% assign filled = pct | times: arc_length | divided_by: 100 %}
      <div class="flex flex--col flex--center flex--middle h--full">
          <svg width="300" height="180" viewBox="0 0 300 180">
            <!-- Background arc -->
            <path d="M 30 150 A 120 120 0 0 1 270 150" fill="none" stroke="#e0e0e0" stroke-width="20" stroke-linecap="round"/>
            <!-- Filled arc -->
            <path d="M 30 150 A 120 120 0 0 1 270 150" fill="none" stroke="#1a1a1a" stroke-width="20" stroke-linecap="round"
                  stroke-dasharray="{{ filled }} {{ arc_length }}" />
            <!-- Min label -->
            <text x="30" y="175" text-anchor="middle" font-size="14" fill="#666">{{ min | default: 0 }}</text>
            <!-- Max label -->
            <text x="270" y="175" text-anchor="middle" font-size="14" fill="#666">{{ max | default: 100 }}</text>
            <!-- Value -->
            <text x="150" y="130" text-anchor="middle" font-size="48" font-weight="bold" fill="#1a1a1a">{{ formatted_value | default: value }}</text>
            <!-- Title -->
            {% if title and title != '' %}
            <text x="150" y="160" text-anchor="middle" font-size="16" fill="#666">{{ title }}</text>
          {% endif %}
        </svg>
      </div>

    {% when 'bargauge' %}
      {% assign bar_count = bars | size %}
      {% if bar_count <= 4 %}
        {% assign bar_size = 'progress-bar--xl' %}
        {% assign label_size = 'label--large' %}
        {% assign gap_size = 'gap--space-4' %}
        {% assign use_columns = false %}
      {% elsif bar_count <= 7 %}
        {% assign bar_size = 'progress-bar--large' %}
        {% assign label_size = '' %}
        {% assign gap_size = 'gap--space-3' %}
        {% assign use_columns = false %}
      {% else %}
        {% assign bar_size = 'progress-bar--medium' %}
        {% assign label_size = 'label--small' %}
        {% assign gap_size = 'gap--space-2' %}
        {% assign use_columns = true %}
        {% assign half = bar_count | divided_by: 2 %}
      {% endif %}
      <div class="flex flex--col flex--center flex--middle h--full w--full px--4">
        {% if use_columns %}
        <div class="flex gap--space-4 w--full">
          <div class="flex flex--col {{ gap_size }} w--full">
            {% for bar in bars limit: half %}
            <div class="flex flex--col gap--space-1 w--full">
              <div class="flex justify--between">
                <span class="label {{ label_size }}">{{ bar.name }}</span>
                <span class="label {{ label_size }}">{{ bar.formatted_value }}</span>
              </div>
              {% assign pct_raw = bar.percentage | default: 0 | plus: 2 | divided_by: 5 | times: 5 %}
              {% if pct_raw > 100 %}{% assign pct_rounded = 100 %}{% else %}{% assign pct_rounded = pct_raw %}{% endif %}
              <div class="progress-bar {{ bar_size }} w--full">
                <div class="progress-fill pct--{{ pct_rounded }}"></div>
              </div>
            </div>
            {% endfor %}
          </div>
          <div class="flex flex--col {{ gap_size }} w--full">
            {% for bar in bars offset: half %}
            <div class="flex flex--col gap--space-1 w--full">
              <div class="flex justify--between">
                <span class="label {{ label_size }}">{{ bar.name }}</span>
                <span class="label {{ label_size }}">{{ bar.formatted_value }}</span>
              </div>
              {% assign pct_raw = bar.percentage | default: 0 | plus: 2 | divided_by: 5 | times: 5 %}
              {% if pct_raw > 100 %}{% assign pct_rounded = 100 %}{% else %}{% assign pct_rounded = pct_raw %}{% endif %}
              <div class="progress-bar {{ bar_size }} w--full">
                <div class="progress-fill pct--{{ pct_rounded }}"></div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% else %}
        <div class="flex flex--col {{ gap_size }} w--full">
          {% for bar in bars %}
          <div class="flex flex--col gap--space-1 w--full">
            <div class="flex justify--between">
              <span class="label {{ label_size }}">{{ bar.name }}</span>
              <span class="label {{ label_size }}">{{ bar.formatted_value }}</span>
            </div>
            {% assign pct_raw = bar.percentage | default: 0 | plus: 2 | divided_by: 5 | times: 5 %}
            {% if pct_raw > 100 %}{% assign pct_rounded = 100 %}{% else %}{% assign pct_rounded = pct_raw %}{% endif %}
            <div class="progress-bar {{ bar_size }} w--full">
              <div class="progress-fill pct--{{ pct_rounded }}"></div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>

    {% when 'table' %}
      <div class="flex flex--col h--full overflow--hidden">
        <table class="table table--compact w--full">
          <thead>
            <tr>
              {% for col in columns %}<th class="px--1 py--0 text--left border--h-1">{{ col }}</th>{% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
            <tr>
              {% for cell in row %}<td class="px--1 py--0 text--left border--h-7">{{ cell }}</td>{% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    {% when 'polystat' %}
      {% assign stat_count = stats | size %}
      {% if stat_count <= 10 %}
        {% assign size_class = 'hex--full-xl' %}{% assign row_size = 5 %}
      {% elsif stat_count <= 20 %}
        {% assign size_class = 'hex--full-lg' %}{% assign row_size = 6 %}
      {% elsif stat_count <= 35 %}
        {% assign size_class = 'hex--full-md' %}{% assign row_size = 7 %}
      {% else %}
        {% assign size_class = 'hex--full-sm' %}{% assign row_size = 11 %}
      {% endif %}
      <div class="honeycomb {{ size_class }}">
        {% for stat in stats %}
          {% assign mod = forloop.index0 | modulo: row_size %}
          {% if mod == 0 %}<div class="hex-row">{% endif %}
          <div class="hexagon flex flex--col flex--center flex--middle status-{{ stat.status | default: 'ok' }}">
            <span class="hex-label text--center text--white">{{ stat.name }}</span>
          </div>
          {% if forloop.last %}
            {% assign remaining = row_size | minus: mod | minus: 1 %}
            {% for i in (1..remaining) %}<div class="hexagon placeholder"></div>{% endfor %}
          </div>
          {% else %}
            {% assign next_mod = forloop.index | modulo: row_size %}
            {% if next_mod == 0 %}</div>{% endif %}
          {% endif %}
        {% endfor %}
      </div>

    {% when 'error' %}
      <div class="flex flex--col flex--center flex--middle gap--space-4 h--full">
        <div class="label label--large">Error</div>
        <div class="description">{{ error_message | default: 'Failed to load data' }}</div>
      </div>

    {% else %}
      <div class="flex flex--col flex--center flex--middle gap--space-4 h--full">
        <div class="value value--xxxl">{{ formatted_value | default: value | default: '--' }}</div>
      </div>
  {% endcase %}
</div>

<div class="title_bar">
  <img class="image" src="https://grafana.com/static/assets/img/fav32.png" />
  <span class="title">{{ title | default: 'Grafana Panel' }}</span>
  <span class="instance">{{ timestamp }}</span>
</div>
