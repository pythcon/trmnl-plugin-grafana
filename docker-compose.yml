services:
  # ============================================
  # WEBHOOK MODE - Data Service pushes to TRMNL
  # ============================================
  # Use this if you're behind a firewall or prefer push-based updates.
  # The service runs continuously, pushing data every INTERVAL seconds.
  #
  # Run with: docker-compose up grafana-trmnl-webhook
  #
  trmnl-plugin-grafana-webhook:
    image: ghcr.io/pythcon/trmnl-plugin-grafana:latest
    container_name: trmnl-plugin-grafana-webhook
    restart: unless-stopped
    environment:
      - MODE=webhook
      - GRAFANA_URL=${GRAFANA_URL}
      - GRAFANA_API_KEY=${GRAFANA_API_KEY}
      - DASHBOARD_UID=${DASHBOARD_UID}
      - PANEL_ID=${PANEL_ID}
      - TIME_FROM=${TIME_FROM:-now-1h}
      - TIME_TO=${TIME_TO:-now}
      - LABEL=${LABEL:-name}
      - VARIABLES=${VARIABLES:-"{}"}
      - TRMNL_WEBHOOK_URL=${TRMNL_WEBHOOK_URL}
      - INTERVAL=${INTERVAL:-300}

  # ============================================
  # API MODE - TRMNL polls this endpoint
  # ============================================
  # Use this if you have a public endpoint or want TRMNL to control refresh timing.
  # Configure TRMNL's Polling URL to point to this service.
  #
  # Run with: docker-compose up grafana-trmnl-api
  #
  trmnl-plugin-grafana-api:
    image: ghcr.io/pythcon/trmnl-plugin-grafana:latest
    container_name: trmnl-plugin-grafana-api
    restart: unless-stopped
    ports:
      - "${API_PORT:-8080}:8080"
    environment:
      - MODE=api
      - GRAFANA_URL=${GRAFANA_URL}
      - GRAFANA_API_KEY=${GRAFANA_API_KEY}
      - DASHBOARD_UID=${DASHBOARD_UID}
      - PANEL_ID=${PANEL_ID}
      - TIME_FROM=${TIME_FROM:-now-1h}
      - TIME_TO=${TIME_TO:-now}
      - LABEL=${LABEL:-name}
      - VARIABLES=${VARIABLES:-"{}"}
