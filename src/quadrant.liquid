{% comment %} Quadrant layout (400x240) {% endcomment %}

<div class="layout layout--col">
  {% case panel_type %}
    {% when 'stat' %}
      <div class="flex flex--col flex--center flex--middle gap--space-1 h--full">
        {% if title and title != '' %}
        <div class="label label--small">{{ title }}</div>
        {% endif %}
        <div class="value value--xl">{{ formatted_value | default: value }}</div>
      </div>

    {% when 'timeseries', 'barchart', 'graph' %}
      {% assign chart_id = 'chart-q' | append_random %}
      <div class="flex flex--col gap--space-1 h--full">
        <div id="{{ chart_id }}" class="w--full flex--grow"></div>
      </div>
      <script src="https://usetrmnl.com/js/highcharts/12.3.0/highcharts.js"></script>
      <script>
        Highcharts.chart('{{ chart_id }}', {
          chart: { type: 'line', backgroundColor: 'transparent', height: 160, margin: [5, 5, 5, 25] },
          title: { text: null },
          credits: { enabled: false },
          legend: { enabled: false },
          plotOptions: {
            series: {
              animation: false,
              color: '#000000',
              lineWidth: 1.5,
              marker: { enabled: false }
            }
          },
          xAxis: {
            visible: false
          },
          yAxis: {
            title: { text: null },
            gridLineColor: '#dddddd'
          },
          series: [{
            data: [{% for point in chart_data %}{{ point.value }}{% unless forloop.last %},{% endunless %}{% endfor %}]
          }]
        });
      </script>

    {% when 'gauge' %}
      {% assign pct = percentage | default: 0 %}
      {% assign arc_length = 125.6 %}
      {% assign filled = pct | times: arc_length | divided_by: 100 %}
      <div class="flex flex--col flex--center flex--middle h--full">
        <svg width="150" height="95" viewBox="0 0 150 95">
          <path d="M 15 80 A 60 60 0 0 1 135 80" fill="none" stroke="#e0e0e0" stroke-width="12" stroke-linecap="round"/>
          <path d="M 15 80 A 60 60 0 0 1 135 80" fill="none" stroke="#1a1a1a" stroke-width="12" stroke-linecap="round"
                stroke-dasharray="{{ filled }} {{ arc_length }}" />
          <text x="15" y="93" text-anchor="middle" font-size="9" fill="#666">{{ min | default: 0 }}</text>
          <text x="135" y="93" text-anchor="middle" font-size="9" fill="#666">{{ max | default: 100 }}</text>
          <text x="75" y="70" text-anchor="middle" font-size="24" font-weight="bold" fill="#1a1a1a">{{ formatted_value | default: value }}</text>
        </svg>
      </div>

    {% when 'bargauge' %}
      <div class="flex flex--col gap--space-1 h--full">
        {% if title and title != '' %}
        <div class="label label--small">{{ title }}</div>
        {% endif %}
        {% for bar in bars limit: 2 %}
        {% assign pct_raw = bar.percentage | default: 0 | plus: 2 | divided_by: 5 | times: 5 %}
        {% if pct_raw > 100 %}{% assign pct_rounded = 100 %}{% else %}{% assign pct_rounded = pct_raw %}{% endif %}
        <div class="progress-bar progress-bar--small">
          <div class="progress-fill pct--{{ pct_rounded }}"></div>
          <span class="progress-value">{{ bar.formatted_value }}</span>
        </div>
        {% endfor %}
      </div>

    {% when 'table' %}
      <div class="flex flex--col gap--space-1 h--full overflow--hidden">
        {% if title and title != '' %}
        <div class="label label--small text--center">{{ title }}</div>
        {% endif %}
        <table class="table w--full">
          <tbody>
            {% for row in rows limit: 3 %}
            <tr>
              {% for cell in row limit: 2 %}<td class="p--1 text--left border--h-7">{{ cell }}</td>{% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    {% when 'polystat' %}
      <div class="hex--q flex flex--wrap flex--center-x flex--content-start w--full h--full">
        {% assign row_size = 2 %}
        {% for stat in stats limit: 4 %}
          {% assign mod = forloop.index0 | modulo: row_size %}
          {% if mod == 0 %}<div class="hex-row flex flex--center-x w--full">{% endif %}
          <div class="hexagon flex flex--col flex--center-x flex--center-y mx--0.5 status-{{ stat.status | default: 'ok' }}">
            <span class="hex-label text--center text--white px--0.5">{{ stat.name }}</span>
          </div>
          {% assign next_mod = forloop.index | modulo: row_size %}
          {% if next_mod == 0 or forloop.last %}</div>{% endif %}
        {% endfor %}
      </div>

    {% when 'error' %}
      <div class="flex flex--col flex--center flex--middle h--full">
        <div class="label label--small">Error</div>
      </div>

    {% else %}
      <div class="flex flex--col flex--center flex--middle gap--space-1 h--full">
        <div class="value value--xl">{{ formatted_value | default: value | default: '--' }}</div>
      </div>
  {% endcase %}
</div>
